(function(){function ee(){const s=window.location.href;return s.includes("/in/")?"profile":s.includes("/search/")?"search":s.includes("/feed")?"feed":s.includes("/messaging")?"messages":"unknown"}function ue(){const s=window.location.href.match(/linkedin\.com\/in\/([^/?]+)/);return s?s[1]:null}function de(s,t=5e3){return new Promise(n=>{const e=document.querySelector(s);if(e){n(e);return}const r=new MutationObserver(()=>{const o=document.querySelector(s);o&&(r.disconnect(),n(o))});r.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{r.disconnect(),n(null)},t)})}async function fe(){var h,g,q,_,b,x,C,I,$,v,O,w;const s=ue();if(!s)return null;await de("h1");const t=((g=(h=document.querySelector("h1"))==null?void 0:h.textContent)==null?void 0:g.trim())||"",n=((_=(q=document.querySelector(".text-body-medium.break-words"))==null?void 0:q.textContent)==null?void 0:_.trim())||"",e=((x=(b=document.querySelector(".text-body-small.inline.t-black--light.break-words"))==null?void 0:b.textContent)==null?void 0:x.trim())||null,r=document.querySelector(".pv-top-card-profile-picture__image"),o=(r==null?void 0:r.src)||null,c=document.querySelector("#about"),l=(($=(I=(C=c==null?void 0:c.closest("section"))==null?void 0:C.querySelector(".inline-show-more-text"))==null?void 0:I.textContent)==null?void 0:$.trim())||null,a=document.querySelector('[data-field="experience_company_logo"]'),i=((w=(O=(v=a==null?void 0:a.closest("li"))==null?void 0:v.querySelector('span[aria-hidden="true"]'))==null?void 0:O.textContent)==null?void 0:w.trim())||null,[u]=n.split(" at "),d=me(),f=pe(),y=he(),m=t.split(" "),S=m[0]||"",A=m.slice(1).join(" ")||"";return{linkedinUrl:window.location.href.split("?")[0],publicIdentifier:s,firstName:S,lastName:A,fullName:t,headline:n,location:e,about:l,profilePictureUrl:o,currentCompany:i,currentTitle:(u==null?void 0:u.trim())||null,experience:d,education:f,skills:y,scrapedAt:new Date().toISOString(),isPartial:!1}}function me(){var e;const s=[],t=document.querySelector("#experience");if(!t)return s;const n=(e=t.closest("section"))==null?void 0:e.querySelectorAll("li.artdeco-list__item");return n==null||n.forEach(r=>{var a,i,u;const o=r.querySelector('.t-bold span[aria-hidden="true"]'),c=r.querySelector('.t-normal span[aria-hidden="true"]'),l=r.querySelector('.t-black--light span[aria-hidden="true"]');o&&s.push({title:((a=o.textContent)==null?void 0:a.trim())||"",company:((i=c==null?void 0:c.textContent)==null?void 0:i.trim())||"",companyLinkedinUrl:null,location:null,startDate:null,endDate:null,duration:((u=l==null?void 0:l.textContent)==null?void 0:u.trim())||null,description:null})}),s}function pe(){var e;const s=[],t=document.querySelector("#education");if(!t)return s;const n=(e=t.closest("section"))==null?void 0:e.querySelectorAll("li.artdeco-list__item");return n==null||n.forEach(r=>{var l,a;const o=r.querySelector('.t-bold span[aria-hidden="true"]'),c=r.querySelector('.t-normal span[aria-hidden="true"]');o&&s.push({school:((l=o.textContent)==null?void 0:l.trim())||"",schoolLinkedinUrl:null,degree:((a=c==null?void 0:c.textContent)==null?void 0:a.trim())||null,fieldOfStudy:null,startYear:null,endYear:null,description:null})}),s}function he(){var e;const s=[],t=document.querySelector("#skills");if(!t)return s;const n=(e=t.closest("section"))==null?void 0:e.querySelectorAll("li.artdeco-list__item");return n==null||n.forEach(r=>{const o=r.querySelector('.t-bold span[aria-hidden="true"]');o!=null&&o.textContent&&s.push(o.textContent.trim())}),s}function ge(){const s=[];return document.querySelectorAll(".reusable-search__result-container").forEach(n=>{var i,u,d,f;const e=n.querySelector("a.app-aware-link"),r=n.querySelector('.entity-result__title-text a span[aria-hidden="true"]'),o=n.querySelector(".entity-result__primary-subtitle"),c=n.querySelector(".entity-result__secondary-subtitle"),l=e==null?void 0:e.href,a=l?(i=l.match(/\/in\/([^/?]+)/))==null?void 0:i[1]:null;if(a){const y=((u=r==null?void 0:r.textContent)==null?void 0:u.trim())||"",m=y.split(" ");s.push({linkedinUrl:`https://www.linkedin.com/in/${a}`,publicIdentifier:a,firstName:m[0]||"",lastName:m.slice(1).join(" ")||"",fullName:y,headline:((d=o==null?void 0:o.textContent)==null?void 0:d.trim())||"",location:((f=c==null?void 0:c.textContent)==null?void 0:f.trim())||null,scrapedAt:new Date().toISOString(),isPartial:!0})}}),s}function ye(){return new URLSearchParams(window.location.search).get("keywords")||""}function k(s){var t;try{if(!((t=chrome.runtime)!=null&&t.id)){console.log("[ClaudIn] Extension context invalidated, please refresh the page");return}chrome.runtime.sendMessage(s).catch(()=>{console.log("[ClaudIn] Extension reloaded, please refresh the page")})}catch{console.log("[ClaudIn] Extension context invalidated, please refresh the page")}}function te(s){const t=new Date,n=s.toLowerCase().trim();if(n.includes("just now")||n.includes("now"))return t.toISOString();const e=n.match(/(\d+)\s*(s|m|h|d|w|mo|y)/);if(!e)return t.toISOString();const[,r,o]=e,c=parseInt(r);switch(o){case"s":t.setSeconds(t.getSeconds()-c);break;case"m":t.setMinutes(t.getMinutes()-c);break;case"h":t.setHours(t.getHours()-c);break;case"d":t.setDate(t.getDate()-c);break;case"w":t.setDate(t.getDate()-c*7);break;case"mo":t.setMonth(t.getMonth()-c);break;case"y":t.setFullYear(t.getFullYear()-c);break}return t.toISOString()}function ne(){const s=[],t=[".msg-conversation-listitem",".msg-conversations-container__convo-item",'[data-control-name="view_message"]',".msg-conversation-card",'li[class*="msg-conversation"]'];let n=null;for(const e of t){const r=document.querySelectorAll(e);if(r.length>0){n=r,console.log(`[ClaudIn] Found ${r.length} conversations with selector: ${e}`);break}}if(!n||n.length===0){const e=document.querySelector(".msg-conversations-container, .scaffold-layout__list");e&&(n=e.querySelectorAll("li"),console.log(`[ClaudIn] Found ${n.length} li items in conversation list`))}return n?(n.forEach((e,r)=>{var S,A,h,g;const o=e.querySelector('[class*="participant-name"], [class*="title"], h3, h4'),c=e.querySelector('[class*="message-preview"], [class*="snippet"], p'),l=e.querySelector('[class*="time"], time, [class*="timestamp"]'),a=e.querySelector('a[href*="/messaging/"]'),u=((a==null?void 0:a.href)||window.location.href).match(/thread\/([^/?]+)/),d=(u==null?void 0:u[1])||`conv_${r}_${Date.now()}`,f=e.querySelector('a[href*="/in/"]'),y=((A=(S=f==null?void 0:f.href)==null?void 0:S.match(/\/in\/([^/?]+)/))==null?void 0:A[1])||"",m=((h=c==null?void 0:c.textContent)==null?void 0:h.trim())||((g=o==null?void 0:o.textContent)==null?void 0:g.trim())||"";m&&s.push({id:`msg_${d}_${Date.now()}_${r}`,conversationId:d,profileId:y,direction:"received",content:m,sentAt:te((l==null?void 0:l.textContent)||""),isRead:!0,scrapedAt:new Date().toISOString()})}),console.log(`[ClaudIn] Extracted ${s.length} messages`),s):(console.log("[ClaudIn] No conversation items found. DOM classes:",Array.from(document.querySelectorAll('[class*="msg-"]')).slice(0,5).map(e=>e.className)),s)}function Se(s){var a,i;const t=s.querySelector('[class*="feed-shared-article"], [class*="update-components-article"], [class*="feed-shared-external-video"], [class*="article-content"]');if(!t)return null;const n=t.querySelector("a[href]");if(!n)return null;const e=n.href;if(!e||e.includes("linkedin.com"))return null;const r=t.querySelector('[class*="article__title"], [class*="mini-update__title"], [class*="feed-shared-article__title"], span[dir="ltr"]'),o=t.querySelector('[class*="article__subtitle"], [class*="article__description"], [class*="feed-shared-article__subtitle"]'),c=t.querySelector("img");let l=null;try{l=new URL(e).hostname.replace("www.","")}catch{}return{url:e,title:((a=r==null?void 0:r.textContent)==null?void 0:a.trim())||null,description:((i=o==null?void 0:o.textContent)==null?void 0:i.trim())||null,imageUrl:(c==null?void 0:c.src)||null,domain:l}}function we(s){const t=s.querySelector("video[src]");if(t!=null&&t.src)return t.src;const n=s.querySelector("video source[src]");if(n!=null&&n.src)return n.src;const e=s.querySelector("[data-video-url]");return e?e.getAttribute("data-video-url"):null}function qe(s){const t=s.match(/#[\w\u00C0-\u024F]+/g)||[];return[...new Set(t.map(n=>n.toLowerCase()))]}function _e(s){const t=s.querySelectorAll('a[href*="/in/"]'),n=[];return t.forEach(e=>{const r=e.href.match(/\/in\/([^/?]+)/);r&&e.closest('[class*="feed-shared-text"], [class*="commentary"]')&&n.push(r[1])}),[...new Set(n)]}function be(s,t,n,e,r,o,c){return c?"repost":o?"poll":s.querySelector('[class*="job-posting"], [class*="jobs-job"]')?"job":s.querySelector('[class*="celebration"], [class*="work-anniversary"], [class*="hiring"]')?"celebration":s.querySelector('[class*="event"]')?"event":e?"document":n?"video":r?"article":t?"image":"text"}function se(){const s=[],t=[".feed-shared-update-v2",'[data-urn*="activity"]',".occludable-update",'div[data-id*="urn:li:activity"]'];let n=null;for(const e of t){const r=document.querySelectorAll(e);if(r.length>0){n=r;break}}return!n||n.length===0?(console.log("[ClaudIn] No feed items found"),s):(n.forEach((e,r)=>{var Y,z,V,E,Q,B,G,J,K,W,X;const o=e.querySelector('[class*="update-components-actor"], [class*="feed-shared-actor"]');if(!o)return;const c=o.querySelector('a[href*="/in/"]'),l=((z=(Y=c==null?void 0:c.href)==null?void 0:Y.match(/\/in\/([^/?]+)/))==null?void 0:z[1])||"";if(!l)return;const a=o.querySelector('[class*="actor__name"], [class*="actor__title"]'),i=(a==null?void 0:a.querySelector(':scope > span[aria-hidden="true"] > span[aria-hidden="true"]'))||(a==null?void 0:a.querySelector(':scope > span[aria-hidden="true"]')),u=((V=i==null?void 0:i.textContent)==null?void 0:V.trim())||"",d=o.querySelector('[class*="actor__description"], [class*="actor__subtitle"]'),f=(d==null?void 0:d.querySelector(':scope > span[aria-hidden="true"] > span[aria-hidden="true"]'))||(d==null?void 0:d.querySelector(':scope > span[aria-hidden="true"]')),y=((E=f==null?void 0:f.textContent)==null?void 0:E.trim())||null,m=o.querySelector('img[class*="presence-entity"], img[class*="actor__avatar-image"], img[alt]'),S=e.querySelector('[class*="feed-shared-text"] span[dir="ltr"], [class*="update-components-text"] span[dir="ltr"], [class*="commentary"] span[dir="ltr"]'),h=o.querySelectorAll('[class*="actor__sub-description"] span[aria-hidden="true"]')[0],g=e.querySelector('[class*="reaction-count"], [class*="social-counts__reactions"]'),q=e.querySelector('[class*="social-counts__comments"], button[aria-label*="comment"]'),_=e.querySelector('[class*="social-counts__reposts"], button[aria-label*="repost"]'),b=!!e.querySelector('[class*="feed-shared-image"], img[class*="feed"], [class*="update-components-image"]'),x=!!e.querySelector('video, [class*="video-player"], [class*="feed-shared-video"]'),C=!!e.querySelector('[class*="document"], [class*="feed-shared-document"]'),I=!!e.querySelector('[class*="poll"], [class*="feed-shared-poll"]'),$=Se(e),v=$!==null,O=we(e),w=e.querySelector('[class*="feed-shared-update-v2__content"] [class*="update-components-actor"]'),U=!!w;let R=null,j=null;if(U&&w){const p=w.querySelector('a[href*="/in/"]');j=((B=(Q=p==null?void 0:p.href)==null?void 0:Q.match(/\/in\/([^/?]+)/))==null?void 0:B[1])||null;const M=w.querySelector('[class*="actor__name"] span[aria-hidden="true"]');R=((G=M==null?void 0:M.textContent)==null?void 0:G.trim())||null}const oe=(e.querySelector('[class*="feed-shared-update-v2__content"], [class*="update-components-content"]')||e).querySelectorAll('img[src*="media"], img[src*="dms.licdn"]'),ce=Array.from(oe).map(p=>p.src).filter(p=>p&&!p.includes("profile-displayphoto")&&!p.includes("shrink_100")&&!p.includes("ghost")).slice(0,10),L=(e.getAttribute("data-urn")||e.getAttribute("data-id")||"").match(/activity:(\d+)/),H=(L==null?void 0:L[1])||`post_${Date.now()}_${r}`,N=((J=S==null?void 0:S.textContent)==null?void 0:J.trim())||"",ae=be(e,b,x,C,v,I,U);if(!N&&!b&&!x&&!C&&!v&&!I)return;const le=qe(N),ie=_e(e);s.push({id:H,authorProfileId:"",authorPublicIdentifier:l,authorName:u||"",authorHeadline:y,authorProfilePictureUrl:(m==null?void 0:m.src)||null,content:N,postUrl:`https://www.linkedin.com/feed/update/urn:li:activity:${H}`,postType:ae,likesCount:parseInt(((K=g==null?void 0:g.textContent)==null?void 0:K.replace(/\D/g,""))||"0"),commentsCount:parseInt(((W=q==null?void 0:q.textContent)==null?void 0:W.replace(/\D/g,""))||"0"),repostsCount:parseInt(((X=_==null?void 0:_.textContent)==null?void 0:X.replace(/\D/g,""))||"0"),hasImage:b,hasVideo:x,hasDocument:C,hasLink:v,hasPoll:I,imageUrls:ce,videoUrl:O,sharedLink:$,isRepost:U,originalAuthorName:R,originalAuthorIdentifier:j,hashtags:le,mentions:ie,postedAt:te((h==null?void 0:h.textContent)||""),scrapedAt:new Date().toISOString()})}),console.log(`[ClaudIn] Extracted ${s.length} posts`),s)}async function F(){const s=ee();switch(console.log(`[ClaudIn] Detected page type: ${s}`),s){case"profile":{const t=await fe();t&&(console.log("[ClaudIn] Scraped profile:",t.fullName),k({type:"profile",url:window.location.href,timestamp:new Date().toISOString(),data:t}));break}case"search":{const t=ge(),n=ye();console.log(`[ClaudIn] Scraped ${t.length} search results for: ${n}`),k({type:"search",url:window.location.href,timestamp:new Date().toISOString(),data:{query:n,results:t}});break}case"messages":{const t=ne();console.log(`[ClaudIn] Scraped ${t.length} message threads`),k({type:"messages",url:window.location.href,timestamp:new Date().toISOString(),data:{messages:t}});break}case"feed":{const t=se();console.log(`[ClaudIn] Scraped ${t.length} feed posts`),k({type:"feed",url:window.location.href,timestamp:new Date().toISOString(),data:{posts:t}});break}}}let Z=window.location.href,P=new Set,T=new Set;const xe=new MutationObserver(()=>{window.location.href!==Z&&(Z=window.location.href,P.clear(),T.clear(),setTimeout(F,2e3))});xe.observe(document.body,{childList:!0,subtree:!0});function re(){const s=ee();if(s==="feed"){const n=se().filter(e=>!P.has(e.id));n.length>0&&(n.forEach(e=>P.add(e.id)),console.log(`[ClaudIn] Found ${n.length} new posts (total: ${P.size})`),k({type:"feed",url:window.location.href,timestamp:new Date().toISOString(),data:{posts:n}}))}if(s==="messages"){const n=ne().filter(e=>!T.has(e.id));n.length>0&&(n.forEach(e=>T.add(e.id)),console.log(`[ClaudIn] Found ${n.length} new messages (total: ${T.size})`),k({type:"messages",url:window.location.href,timestamp:new Date().toISOString(),data:{messages:n}}))}}let D=null;window.addEventListener("scroll",()=>{D&&clearTimeout(D),D=setTimeout(re,1e3)},{passive:!0});const Ce=new MutationObserver(()=>{D&&clearTimeout(D),D=setTimeout(re,1500)});Ce.observe(document.body,{childList:!0,subtree:!0});setTimeout(F,2e3);try{chrome.runtime.onMessage.addListener((s,t,n)=>{if(s.type==="FORCE_SCRAPE")return console.log("[ClaudIn] Force scrape requested"),F().then(()=>{n({success:!0})}),!0})}catch{console.log("[ClaudIn] Could not add message listener")}console.log("[ClaudIn] Content script loaded");
})()
